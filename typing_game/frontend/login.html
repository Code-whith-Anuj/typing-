<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Adaptive Typist</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="login-page">
    
    <div class="login-box">
        <div class="logo">
            <i class="fas fa-keyboard"></i>
            <h1>Adaptive Typist</h1>
        </div>

        <div class="input-group">
            <i class="fas fa-user"></i>
            <input type="text" id="username" placeholder="Username" autocomplete="off">
        </div>

        <div class="input-group">
            <i class="fas fa-lock"></i>
            <input type="password" id="password" placeholder="Password">
        </div>

        <div class="error-text" id="error-msg"></div>

        <div class="button-group">
            <button class="btn" id="register-btn">Register</button>
            <button class="btn btn-primary" id="login-btn">Login</button>
        </div>
    </div>

    <button class="theme-toggle" id="themeToggle">
        <span class="icon">‚óê</span>
        <span class="label">MODE</span>
    </button>

    <script>
        // Theme Logic
        const toggle = document.getElementById('themeToggle');
        if (localStorage.getItem('theme') === 'day') {
            document.body.classList.add('day-mode');
        }
        toggle.addEventListener('click', () => {
            document.body.classList.toggle('day-mode');
            localStorage.setItem('theme', document.body.classList.contains('day-mode') ? 'day' : 'night');
        });

        // Auth Logic
        const loginBtn = document.getElementById('login-btn');
        const registerBtn = document.getElementById('register-btn');
        const errorMsg = document.getElementById('error-msg');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');

        async function handleAuth(endpoint) {
            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();
            
            if (!username || !password) {
                errorMsg.textContent = 'Please enter credentials';
                return;
            }

            try {
                const response = await fetch(`/api/${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    if (endpoint === 'login') {
                        // Save user info and redirect
                        localStorage.setItem('typing_user_id', data.user_id);
                        localStorage.setItem('typing_level', data.level);
                        window.location.href = '/';
                    } else {
                        // Auto-login after register
                        handleAuth('login');
                    }
                } else {
                    errorMsg.textContent = data.error || 'Authentication failed';
                }
            } catch (err) {
                errorMsg.textContent = 'Server connection failed';
            }
        }

        loginBtn.addEventListener('click', () => handleAuth('login'));
        registerBtn.addEventListener('click', () => handleAuth('register'));
        
        // Enter key support
        passwordInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleAuth('login');
        });
    </script>
</body>
</html>